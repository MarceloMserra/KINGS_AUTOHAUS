<!-- views/financing.hbs -->

<style>
    /* Estilos globais para HTML e Body */
    html, body {
        background-color: #000000 !important;
        color: #ffffff !important;
        min-height: 100vh !important;
        overflow-x: hidden; /* Evita scroll horizontal */
    }
    
    /* Contêiner principal da página de financiamento */
    .financing-container {
        background-color: #000000;
        min-height: 100vh;
        padding-top: 140px; /* Ajuste com base na altura do seu cabeçalho */
        padding-bottom: 50px;
    }
    
    /* Seção Hero (cabeçalho da página de financiamento) */
    .financing-hero {
        background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
        padding: 60px 0;
        text-align: center;
        margin-bottom: 50px;
    }
    
    .financing-title {
        color: #05FC04;
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    
    .financing-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.2rem;
        margin-bottom: 30px;
    }
    
    /* Estilo do formulário de financiamento */
    .financing-form {
        background-color: #1a1a1a;
        border: 1px solid #333333;
        border-radius: 15px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        margin-bottom: 30px;
    }
    
    /* Estilo dos cabeçalhos de seção dentro do formulário */
    .section-header {
        background: linear-gradient(45deg, #05FC04, #04D803);
        color: #000000;
        padding: 15px 25px;
        border-radius: 10px;
        margin-bottom: 30px;
        text-align: center;
        font-weight: bold;
        font-size: 1.3rem;
    }
    
    /* Estilo dos labels dos campos de formulário */
    .form-group label {
        color: #ffffff;
        font-weight: bold;
        margin-bottom: 8px;
        display: block;
    }
    
    /* Estilo dos campos de input e select */
    .form-control {
        background-color: #0d0d0d !important;
        color: #ffffff !important;
        border: 1px solid #05FC04 !important;
        border-radius: 8px !important;
        padding: 12px 15px !important;
        transition: all 0.3s ease !important;
        font-size: 1rem;
    }
    
    .form-control:focus {
        border-color: #04D803 !important;
        box-shadow: 0 0 0 0.2rem rgba(5, 252, 4, 0.25) !important;
        background-color: #000000 !important;
        color: #ffffff !important;
        outline: none !important;
    }
    
    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.5) !important;
    }
    
    /* Estilo do botão de submit */
    .btn-submit {
        background: linear-gradient(45deg, #05FC04, #04D803);
        border: none;
        color: #000000;
        font-weight: bold;
        padding: 15px 40px;
        border-radius: 25px;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
    }
    
    .btn-submit:hover {
        background: linear-gradient(45deg, #04D803, #03C602);
        color: #ffffff;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(5, 252, 4, 0.4);
    }
    
    /* Seção do Co-Buyer (escondida por padrão) */
    .co-buyer-section {
        border-left: 3px solid #05FC04;
        padding: 25px;
        margin: 20px 0;
        background-color: rgba(5, 252, 4, 0.05);
        border-radius: 10px;
        display: none; /* Começa escondido */
        transition: all 0.5s ease;
    }
    
    /* Estilos para os checkboxes */
    .form-check {
        margin-bottom: 20px;
        display: flex; /* Usa flexbox para alinhamento */
        align-items: center; /* Alinha itens verticalmente ao centro */
        padding: 15px;
        background-color: rgba(5, 252, 4, 0.05);
        border-radius: 8px;
        border: 1px solid rgba(5, 252, 4, 0.2);
        transition: all 0.3s ease;
        position: relative;
    }
    
    .form-check:hover {
        background-color: rgba(5, 252, 4, 0.1);
        border-color: rgba(5, 252, 4, 0.4);
    }
    
    .form-check-input {
        width: 20px;
        height: 20px;
        margin-right: 15px;
        margin-top: 0; /* Remove margin-top default do Bootstrap */
        accent-color: #05FC04; /* Muda a cor do checkbox (moderno) */
        cursor: pointer;
        flex-shrink: 0; /* Evita que o checkbox encolha */
        position: relative;
        z-index: 10;
        /* Reset de aparência padrão do navegador para customização */
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: 2px solid #05FC04;
        border-radius: 4px;
        background-color: transparent;
        display: inline-block;
        vertical-align: middle;
        transition: background-color 0.2s ease, border-color 0.2s ease;
    }

    /* Estilo do checkmark personalizado quando marcado */
    .form-check-input:checked {
        background-color: #05FC04;
        border-color: #05FC04;
    }

    .form-check-input:checked::before {
        content: '\2713'; /* Caractere de checkmark (✓) */
        display: block;
        color: #000000; /* Cor preta para o checkmark */
        font-size: 14px;
        line-height: 1;
        text-align: center;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    
    .form-check-label {
        color: rgba(255, 255, 255, 0.9);
        cursor: pointer;
        font-size: 1rem;
        line-height: 1.4;
        flex-grow: 1;
        user-select: none;
        padding-left: 0; /* Remove padding-left padrão do Bootstrap */
    }

    /* Estilo para labels de campos obrigatórios do co-comprador */
    .co-buyer-required::after {
        content: " *";
        color: #05FC04;
        font-weight: bold;
    }
    
    .required-field::after {
        content: " *";
        color: #05FC04;
        font-weight: bold;
    }
    
    /* Estilos para mensagens de alerta (sucesso/erro) */
    .alert {
        border-radius: 10px;
        padding: 15px 20px;
        margin-bottom: 20px;
        border: none;
    }
    
    .alert-success {
        background-color: rgba(5, 252, 4, 0.2);
        color: #05FC04;
        border: 1px solid #05FC04;
    }
    
    .alert-danger {
        background-color: rgba(220, 53, 69, 0.2);
        color: #dc3545;
        border: 1px solid #dc3545;
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
        .financing-container {
            padding-top: 120px;
        }
        
        .financing-title {
            font-size: 2.2rem;
        }
        
        .financing-form {
            padding: 25px 20px;
            margin: 0 15px;
        }
        
        .form-check {
            padding: 12px;
        }
        
        .form-check-input {
            width: 18px;
            height: 18px;
        }
    }
</style>

<div class="financing-container">
    <div class="container">
        <!-- Hero Section -->
        <div class="financing-hero">
            <h1 class="financing-title">Vehicle Financing</h1>
            <p class="financing-subtitle">Get pre-approved for your dream car in minutes</p>
        </div>

        <!-- Error/Success Messages -->
        {{#if error_msg}}
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle"></i> {{error_msg}}
        </div>
        {{/if}}

        {{#if success_msg}}
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i> {{success_msg}}
        </div>
        {{/if}}

        <!-- Financing Form -->
        <div class="financing-form">
            <form action="/financing-submit" method="POST" id="financingForm">
                
                <!-- Applicant Information -->
                <div class="section-header">
                    <i class="fas fa-user"></i> Applicant Information
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">First Name</label>
                            <input type="text" class="form-control" name="applicantFirstName" placeholder="Enter your first name" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Last Name</label>
                            <input type="text" class="form-control" name="applicantLastName" placeholder="Enter your last name" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Email</label>
                            <input type="email" class="form-control" name="applicantEmail" placeholder="your.email@example.com" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Phone Number</label>
                            <input type="tel" class="form-control" name="applicantMobilePhone" placeholder="(XXX) XXX-XXXX" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">SSN</label>
                            <input type="text" class="form-control" name="applicantSSN" placeholder="XXX-XX-XXXX" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Date of Birth</label>
                            <input type="date" class="form-control" name="applicantDOB" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required-field">Address Line 1</label>
                    <input type="text" class="form-control" name="applicantAddress1" placeholder="Street Address" required>
                </div>
                <div class="form-group">
                    <label>Address Line 2 (Optional)</label>
                    <input type="text" class="form-control" name="applicantAddress2" placeholder="Apartment, Suite, Unit, Building, etc.">
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">City</label>
                            <input type="text" class="form-control" name="applicantCity" placeholder="City" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">State</label>
                            <select class="form-control" name="applicantState" required>
                                <option value="">Select State</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">ZIP Code</label>
                            <input type="text" class="form-control" name="applicantZip" placeholder="ZIP Code" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Time at Residence (Years)</label>
                            <input type="number" class="form-control" name="timeAtResidenceYears" placeholder="e.g., 5" min="0" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Time at Residence (Months)</label>
                            <input type="number" class="form-control" name="timeAtResidenceMonths" placeholder="e.g., 6" min="0" max="11" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Residence Type</label>
                            <select class="form-control" name="residenceType" required>
                                <option value="">Select Type</option>
                                <option value="Own">Own</option>
                                <option value="Rent">Rent</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Monthly Rent/Mortgage Payment</label>
                            <input type="number" class="form-control" name="rentMortgage" placeholder="e.g., 1500" min="0" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Driver's License Number</label>
                            <input type="text" class="form-control" name="applicantDriverLicenseNumber" placeholder="DL Number" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Driver's License State</label>
                            <select class="form-control" name="applicantDriverLicenseState" required>
                                <option value="">Select State</option>
                                <!-- Adicione todos os estados dos EUA aqui, igual ao applicantState -->
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="required-field">Driver's License Expiration (MM/YY)</label>
                    <input type="text" class="form-control" name="applicantDriverLicenseExp" placeholder="MM/YY" pattern="^(0[1-9]|1[0-2])\/?([0-9]{2})$" title="Format: MM/YY" required>
                </div>
                <div class="form-group">
                    <label>Home Phone (Optional)</label>
                    <input type="tel" class="form-control" name="applicantHomePhone" placeholder="(XXX) XXX-XXXX">
                </div>
                <div class="form-group">
                    <label>Middle Initial (Optional)</label>
                    <input type="text" class="form-control" name="applicantMiddleInitial" maxlength="1" placeholder="M">
                </div>

                <!-- Employment Information -->
                <div class="section-header">
                    <i class="fas fa-briefcase"></i> Employment Information
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Employer Name</label>
                            <input type="text" class="form-control" name="employerName" placeholder="Company Name" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Employer Type</label>
                            <select class="form-control" name="employerType" required>
                                <option value="">Select Type</option>
                                <option value="Full-time">Full-time</option>
                                <option value="Part-time">Part-time</option>
                                <option value="Self-employed">Self-employed</option>
                                <option value="Retired">Retired</option>
                                <option value="Unemployed">Unemployed</option>
                                <option value="Student">Student</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Monthly Income</label>
                            <input type="number" class="form-control" name="monthlyIncome" placeholder="5000" min="1000" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Occupation</label>
                            <input type="text" class="form-control" name="occupation" placeholder="Job Title" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required-field">Employer Address Line 1</label>
                    <input type="text" class="form-control" name="employerAddress1" placeholder="Street Address" required>
                </div>
                <div class="form-group">
                    <label>Employer Address Line 2 (Optional)</label>
                    <input type="text" class="form-control" name="employerAddress2" placeholder="Suite, Floor, etc.">
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">Employer City</label>
                            <input type="text" class="form-control" name="employerCity" placeholder="City" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">Employer State</label>
                            <select class="form-control" name="employerState" required>
                                <option value="">Select State</option>
                                <!-- Adicione todos os estados dos EUA aqui, igual ao applicantState -->
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">Employer ZIP Code</label>
                            <input type="text" class="form-control" name="employerZip" placeholder="ZIP Code" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="required-field">Years at Job</label>
                            <input type="number" class="form-control" name="timeOnJobYears" placeholder="2" min="0" max="50" required>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="required-field">Months at Job</label>
                            <input type="number" class="form-control" name="timeOnJobMonths" placeholder="6" min="0" max="11" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Work Phone (Optional)</label>
                            <input type="tel" class="form-control" name="workPhone" placeholder="(XXX) XXX-XXXX">
                        </div>
                    </div>
                </div>

                <!-- Vehicle Information -->
                <div class="section-header">
                    <i class="fas fa-car"></i> Vehicle Information
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">Year</label>
                            <input type="number" class="form-control" name="vehicleYear" placeholder="2023" min="2010" max="2025" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">Make</label>
                            <input type="text" class="form-control" name="vehicleMake" placeholder="Ford" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-field">Model</label>
                            <input type="text" class="form-control" name="vehicleModel" placeholder="Mustang" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Vehicle VIN</label>
                            <input type="text" class="form-control" name="vehicleVin" placeholder="VIN (17 characters)" pattern="^[A-HJ-NPR-Z0-9]{17}$" title="VIN must be 17 alphanumeric characters (excluding I, O, Q)" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-field">Vehicle Mileage</label>
                            <input type="number" class="form-control" name="vehicleMileage" placeholder="e.g., 25000" min="0" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Vehicle Price (Optional)</label>
                            <input type="number" class="form-control" name="vehiclePrice" placeholder="50000" min="1000">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Down Payment (Optional)</label>
                            <input type="number" class="form-control" name="downPayment" placeholder="10000" min="0">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Vehicle Trim (Optional)</label>
                    <input type="text" class="form-control" name="vehicleTrim" placeholder="e.g., GT, Sport">
                </div>
                <div class="form-group">
                    <label>Stock Number (Optional)</label>
                    <input type="text" class="form-control" name="stockNumber" placeholder="Dealership Stock #">
                </div>

                <!-- Co-Buyer Section - COMPLETELY CORRECTED NO ONCLICK -->
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="hasCoBuyer" name="hasCoBuyer" value="true">
                    <label class="form-check-label" for="hasCoBuyer">
                        <i class="fas fa-users"></i> Add Co-Buyer Information
                    </label>
                </div>

                <div id="coBuyerSection" class="co-buyer-section">
                    <div class="section-header">
                        <i class="fas fa-user-plus"></i> Co-Buyer Information
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer First Name</label>
                                <input type="text" class="form-control" name="coBuyerFirstName" placeholder="First Name">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Last Name</label>
                                <input type="text" class="form-control" name="coBuyerLastName" placeholder="Last Name">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Email</label>
                                <input type="email" class="form-control" name="coBuyerEmail" placeholder="cobuyer@example.com">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Phone</label>
                                <input type="tel" class="form-control" name="coBuyerMobilePhone" placeholder="(XXX) XXX-XXXX">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer SSN</label>
                                <input type="text" class="form-control" name="coBuyerSSN" placeholder="XXX-XX-XXXX">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Date of Birth</label>
                                <input type="date" class="form-control" name="coBuyerDOB">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="co-buyer-required">Co-Buyer Address Line 1</label>
                        <input type="text" class="form-control" name="coBuyerAddress1" placeholder="Street Address">
                    </div>
                    <div class="form-group">
                        <label>Co-Buyer Address Line 2 (Optional)</label>
                        <input type="text" class="form-control" name="coBuyerAddress2" placeholder="Apartment, Suite, Unit, Building, etc.">
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer City</label>
                                <input type="text" class="form-control" name="coBuyerCity" placeholder="City">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer State</label>
                                <select class="form-control" name="coBuyerState">
                                    <option value="">Select State</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer ZIP Code</label>
                                <input type="text" class="form-control" name="coBuyerZip" placeholder="ZIP Code">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Time at Residence (Years)</label>
                                <input type="number" class="form-control" name="coBuyerTimeAtResidenceYears" placeholder="e.g., 5" min="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Time at Residence (Months)</label>
                                <input type="number" class="form-control" name="coBuyerTimeAtResidenceMonths" placeholder="e.g., 6" min="0" max="11">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Residence Type</label>
                                <select class="form-control" name="coBuyerResidenceType">
                                    <option value="">Select Type</option>
                                    <option value="Own">Own</option>
                                    <option value="Rent">Rent</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Monthly Rent/Mortgage Payment</label>
                                <input type="number" class="form-control" name="coBuyerRentMortgage" placeholder="e.g., 1500" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="section-header">
                        <i class="fas fa-briefcase"></i> Co-Buyer Employment Information
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Employer Name</label>
                                <input type="text" class="form-control" name="coBuyerEmployerName" placeholder="Company Name">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Employer Type</label>
                                <select class="form-control" name="coBuyerEmployerType">
                                    <option value="">Select Type</option>
                                    <option value="Full-time">Full-time</option>
                                    <option value="Part-time">Part-time</option>
                                    <option value="Self-employed">Self-employed</option>
                                    <option value="Retired">Retired</option>
                                    <option value="Unemployed">Unemployed</option>
                                    <option value="Student">Student</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Monthly Income</label>
                                <input type="number" class="form-control" name="coBuyerMonthlyIncome" placeholder="5000" min="1000">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Occupation</label>
                                <input type="text" class="form-control" name="coBuyerOccupation" placeholder="Job Title">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="co-buyer-required">Co-Buyer Employer Address Line 1</label>
                        <input type="text" class="form-control" name="coBuyerEmployerAddress1" placeholder="Street Address">
                    </div>
                    <div class="form-group">
                        <label>Co-Buyer Employer Address Line 2 (Optional)</label>
                        <input type="text" class="form-control" name="coBuyerEmployerAddress2" placeholder="Suite, Floor, etc.">
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Employer City</label>
                                <input type="text" class="form-control" name="coBuyerEmployerCity" placeholder="City">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Employer State</label>
                                <select class="form-control" name="coBuyerEmployerState">
                                    <option value="">Select State</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Employer ZIP Code</label>
                                <input type="text" class="form-control" name="coBuyerEmployerZip" placeholder="ZIP Code">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Years at Job</label>
                                <input type="number" class="form-control" name="coBuyerTimeOnJobYears" placeholder="2" min="0">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="co-buyer-required">Co-Buyer Months at Job</label>
                                <input type="number" class="form-control" name="coBuyerTimeOnJobMonths" placeholder="6" min="0" max="11">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Co-Buyer Work Phone (Optional)</label>
                                <input type="tel" class="form-control" name="coBuyerWorkPhone" placeholder="(XXX) XXX-XXXX">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Consent Section - NORMAL CHECKBOXES NO ONCLICK -->
                <div class="section-header">
                    <i class="fas fa-shield-alt"></i> Acknowledgment & Consent
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="acknowledgmentConsent" name="acknowledgmentConsent" value="true" required>
                    <label class="form-check-label" for="acknowledgmentConsent">
                        <span class="required-field">I acknowledge and agree to the terms and conditions</span>
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="creditCheckConsent" name="creditCheckConsent" value="true" required>
                    <label class="form-check-label" for="creditCheckConsent">
                        <span class="required-field">I consent to credit check and background verification</span>
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="textMessageConsent" name="textMessageConsent" value="true">
                    <label class="form-check-label" for="textMessageConsent">
                        I consent to receive text messages regarding my application
                    </label>
                </div>

                <!-- Additional Comments (Optional) -->
                <div class="form-group">
                    <label>Additional Comments (Optional)</label>
                    <textarea class="form-control" name="additionalComments" rows="3" placeholder="Any additional information you'd like to provide..."></textarea>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn-submit">
                    <i class="fas fa-paper-plane"></i> Submit Application
                </button>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // CO-BUYER CHECKBOX - NORMAL FUNCTIONALITY NO ONCLICK
    const coBuyerCheckbox = document.getElementById('hasCoBuyer');
    const coBuyerSection = document.getElementById('coBuyerSection');
    
    // Select all co-buyer input fields (text, email, tel, number, select, date, textarea)
    // These inputs will have a 'co-buyer-required' class on their labels if they should become required
    const coBuyerInputs = coBuyerSection.querySelectorAll('input, select, textarea');

    if (coBuyerCheckbox && coBuyerSection) {
        coBuyerCheckbox.addEventListener('change', function() {
            if (this.checked) {
                coBuyerSection.style.display = 'block';
                // Make co-buyer fields required when section is visible
                coBuyerInputs.forEach(input => {
                    // Check if the input's label has the 'co-buyer-required' class
                    const label = input.closest('.form-group')?.querySelector('label');
                    if (label && label.classList.contains('co-buyer-required')) {
                        input.setAttribute('required', 'required');
                    }
                });
            } else {
                coBuyerSection.style.display = 'none';
                // Remove required attribute and clear values when section is hidden
                coBuyerInputs.forEach(input => {
                    input.removeAttribute('required');
                    // Clear values to prevent submitting empty required fields from hidden section
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
            }
        });
    }
    
    // PREVENT ANY REDIRECTION FROM CHECKBOXES - ENSURES ONLY MARKING
    // Este listener é crucial para impedir que outros scripts globais capturem os cliques.
    // Ele deve ser aplicado a todos os checkboxes relevantes no formulário de financiamento.
    const financingCheckboxes = document.querySelectorAll('#financingForm .form-check-input');
    financingCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('click', function(e) {
            e.stopPropagation(); // Prevents event bubbling up to parent elements that might cause redirection
            // console.log('Checkbox click stopped propagation:', this.id); // Para depuração
        });
    });
    
    // AUTOMATIC FIELD FORMATTING
    const phoneInputs = document.querySelectorAll('input[type="tel"]');
    phoneInputs.forEach(input => {
        input.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value.length >= 6) {
                value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
            } else if (value.length >= 3) {
                value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
            }
            this.value = value;
        });
    });
    
    const ssnInputs = document.querySelectorAll('input[name$="SSN"]');
    ssnInputs.forEach(input => {
        input.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value.length >= 5) {
                value = `${value.slice(0, 3)}-${value.slice(3, 5)}-${value.slice(5, 9)}`;
            } else if (value.length >= 3) {
                value = `${value.slice(0, 3)}-${value.slice(3)}`;
            }
            this.value = value;
        });
    });
    
    const zipInputs = document.querySelectorAll('input[name$="Zip"]');
    zipInputs.forEach(input => {
        input.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value.length > 5) {
                value = `${value.slice(0, 5)}-${value.slice(5, 9)}`;
            }
            this.value = value;
        });
    });

    // Driver's License Expiration (MM/YY) formatting
    const dlExpInput = document.querySelector('input[name="applicantDriverLicenseExp"]');
    if (dlExpInput) {
        dlExpInput.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, ''); // Remove non-digits
            if (value.length > 2) {
                value = `${value.slice(0, 2)}/${value.slice(2, 4)}`; // Format as MM/YY
            }
            this.value = value;
        });
    }
    
    // REAL-TIME VALIDATION VISUAL FEEDBACK
    const allFormInputs = document.querySelectorAll('.financing-form input, .financing-form select, .financing-form textarea');
    allFormInputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.hasAttribute('required') && !this.value.trim()) {
                this.style.borderColor = '#dc3545'; /* Red for invalid */
            } else {
                this.style.borderColor = '#05FC04'; /* Green for valid/default */
            }
        });
        
        input.addEventListener('input', function() {
            if (this.value.trim()) {
                this.style.borderColor = '#05FC04'; /* Green when typing */
            }
        });
    });
    
    // FORM SUBMISSION VALIDATION
    const form = document.getElementById('financingForm');
    form.addEventListener('submit', function(e) {
        // Remove 'was-validated' class to reset validation state
        form.classList.remove('was-validated'); 
        
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        let firstInvalidField = null;
        
        requiredFields.forEach(field => {
            // Reset border color before re-validation
            field.style.borderColor = '#05FC04'; 

            // Check for empty required fields
            if (!field.value.trim()) {
                field.style.borderColor = '#dc3545';
                isValid = false;
                if (!firstInvalidField) {
                    firstInvalidField = field;
                }
            } else if (field.type === 'checkbox' && !field.checked) {
                // Specific check for required checkboxes
                field.style.borderColor = '#dc3545';
                isValid = false;
                if (!firstInvalidField) {
                    firstInvalidField = field;
                }
            } else if (field.tagName === 'SELECT' && field.value === '') {
                // Specific check for required select elements
                field.style.borderColor = '#dc3545';
                isValid = false;
                if (!firstInvalidField) {
                    firstInvalidField = field;
                }
            }
        });
        
        // Apply Bootstrap's 'was-validated' class to show native browser validation messages
        if (!isValid) {
            e.preventDefault(); // Prevent form submission
            form.classList.add('was-validated'); // Show validation feedback
            
            // Use a custom modal instead of alert()
            showCustomAlert('Please fill in all required fields correctly.');
            
            if (firstInvalidField) {
                firstInvalidField.focus(); // Focus on the first invalid field
            }
        } else {
            // If valid, allow form submission to the backend route
            // The backend will handle further validation and redirection (as per financing.js)
        }
    });

    // Custom Alert Modal (replace alert() calls)
    function showCustomAlert(message) {
        // Check if a custom alert modal already exists
        let customAlertModal = document.getElementById('customAlertModal');
        if (!customAlertModal) {
            // Create the modal HTML
            customAlertModal = document.createElement('div');
            customAlertModal.id = 'customAlertModal';
            customAlertModal.classList.add('modal', 'fade');
            customAlertModal.setAttribute('tabindex', '-1');
            customAlertModal.setAttribute('role', 'dialog');
            customAlertModal.setAttribute('aria-labelledby', 'customAlertModalLabel');
            customAlertModal.setAttribute('aria-hidden', 'true');
            customAlertModal.innerHTML = `
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content bg-gray-800 text-white border border-green-500 rounded-lg shadow-xl">
                        <div class="modal-header border-b border-gray-700">
                            <h5 class="modal-title text-xl font-bold text-green-400" id="customAlertModalLabel">Validation Error</h5>
                            <button type="button" class="close text-gray-400 hover:text-white" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body text-gray-300">
                            <p>${message}</p>
                        </div>
                        <div class="modal-footer border-t border-gray-700">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(customAlertModal);
        } else {
            // Update message if modal already exists
            customAlertModal.querySelector('.modal-body p').textContent = message;
        }
        // Show the modal
        $(customAlertModal).modal('show');
    }
});
</script>
