<!DOCTYPE html>
<html lang="en">

<head>
    <title>KINGS AUTOHAUS</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Stylesheet -->
    <link rel="icon" href="/images/auto_favi.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/css/style.css">
    <!-- Custom CSS file for premium theme - NOW CONTAINS HEADER STYLES -->
    <link rel="stylesheet" href="/css/premium-theme.css">
    <!-- Link to home.css - IMPORTANT: Ensure this file exists and contains home page specific styles -->
    <link rel="stylesheet" href="/css/home.css">
    <!-- NOVO: Link para financing.css - para a página de financiamento -->
    <link rel="stylesheet" href="/css/financing.css">
    <!-- NOVO: Link para login.css - para a página de login -->
    <link rel="stylesheet" href="/css/login.css">

    {{!-- Icons --}}
    <script src="https://kit.fontawesome.com/f7b393d83e.js" crossorigin="anonymous"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans+Caption&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        xintegrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <!-- CSS personalizado para o cabeçalho fixo e transições -->
    <style>
        /* Garante que a seção de navegação seja fixa no topo */
        #navigation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 1000; /* Garante que o cabeçalho fique acima de outros elementos */
            /* As transições para 'hidden' são definidas no CSS injetado no final do body */
        }

        /* Ajuste para o conteúdo da página não ficar por baixo do cabeçalho fixo */
        /* Este padding será ajustado dinamicamente pelo JavaScript, mas é um bom valor inicial */
        body {
            padding-top: 120px; /* Ajuste este valor de acordo com a altura total do seu cabeçalho */
        }
    </style>
</head>

<body>

    <!-- Top Bar - Geralmente permanece visível, mas pode ser ajustada se necessário -->
    <div class="top-bar bg-gray-900 text-white text-xs py-2 px-4 flex justify-between items-center z-50 relative">
        <div class="flex space-x-3">
            <a href="https://www.facebook.com/kingsautohaus" target="_blank" class="hover:text-green-500"><i class="fab fa-facebook-f"></i></a>
            <a href="https://www.google.com/maps/search/?api=1&query=1278%20Washington%20St,%20Holliston%20MA%2001746" target="_blank" class="hover:text-green-500"><i class="fab fa-google-plus-g"></i></a>
            <a href="https://www.instagram.com/kingsautous/" target="_blank" class="hover:text-green-500"><i class="fab fa-instagram"></i></a>
        </div>
        <div>
            <span class="mr-4"><i class="fas fa-map-marker-alt mr-1"></i>1278 Washington St, Holliston MA 01746</span>
            <span><i class="fas fa-phone mr-1"></i>+1 (774)523-7860</span>
        </div>
    </div>

    <!-- Main Navbar -->
    <section id="navigation">
        <div class="container-fluid" id="nav-container">
            <nav class="navbar navbar-expand-lg" id="main-navbar"> 
                <!-- Logo GRANDE à esquerda -->
                <a class="navbar-brand" href="/">
                    <img src="/images/kings_autohaus_logo.jpeg" alt="KINGS AUTOHAUS Logo">
                </a>
                
                <!-- Botão toggler -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
                    aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <!-- Menu e Informações de Contato/Redes Sociais -->
                <div class="collapse navbar-collapse" id="navbarNavDropdown">
                    <ul class="navbar-nav menu-horizontal">
                        <li class="nav-item">
                            <a class="nav-link" href="/gas">Inventory</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/financing">Financing</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/#about-us">About Us</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/#contact-info">Contact</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn btn-outline-light px-3 py-2"
                                style="border-color: #05FC04; color: #05FC04 !important; border-radius: 5px; font-weight: bold;"
                                href="/login">
                                Login
                            </a>
                        </li>
                    </ul>
                    <!-- Informações de Contato e Redes Sociais - MOVIDAS AQUI -->
                    <div class="navbar-contact-info ml-auto d-flex align-items-center">
                        <span class="contact-info">
                            <i class="fas fa-map-marker-alt"></i> 1278 Washington St, Holliston MA 01746
                        </span>
                        <span class="contact-info mr-3">
                            <i class="fas fa-phone"></i> +1 (774)523-7860
                        </span>
                        <div class="social-icons">
                            <a href="https://www.facebook.com/kingsautohaus" target="_blank" class="mr-2"><i class="fab fa-facebook-f"></i></a>
                            <a href="https://www.google.com/maps/search/?api=1&query=1278%20Washington%20St,%20Holliston%20MA%2001746" target="_blank" class="mr-2"><i class="fab fa-google-plus-g"></i></a>
                            <a href="https://www.instagram.com/kingsautous/" target="_blank" class="mr-2"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </section>

    {{{body}}}

    <!-- Botão de voltar ao topo - SEMPRE VISÍVEL -->
    <button id="backToTop" class="back-to-top-btn" onclick="scrollToTop()" aria-label="Back to Top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        xintegrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        xintegrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script src="/javascripts/ev_cars.js"></script>
    <script src="/javascripts/gas_cars.js"></script>

    <!-- ============================================ -->
    <!-- SCRIPT ÚNICO CORRIGIDO - HEADER E MOBILE MENU -->
    <!-- ============================================ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navigationSection = document.getElementById('navigation');
            const backToTopBtn = document.getElementById('backToTop');
            const body = document.body;
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('#navbarNavDropdown');
            
            let headerHeight = navigationSection ? navigationSection.offsetHeight : 120;
            let isMenuOpen = false;
            let lastScrollTop = 0;
            let isHovering = false; // Controla o estado de hover

            // Função para detectar se é dispositivo móvel
            function isMobileDevice() {
                // A breakpoint de 991.98px é a padrão do Bootstrap para 'lg'
                return window.innerWidth <= 991.98;
            }

            // Função para ajustar o padding-top do body
            function adjustBodyPadding() {
                if (navigationSection) {
                    // Pega a altura atual do cabeçalho (pode variar se houver animações ou responsividade)
                    const currentHeaderHeight = navigationSection.offsetHeight;
                    body.style.paddingTop = `${currentHeaderHeight}px`;
                }
            }

            // Função para mostrar o cabeçalho
            function showHeader() {
                if (navigationSection) {
                    navigationSection.classList.remove('hidden');
                    navigationSection.style.pointerEvents = 'auto'; // Reabilita cliques e interações
                }
            }

            // Função para esconder o cabeçalho (só no desktop e quando não estiver hover)
            function hideHeader() {
                if (navigationSection && !isMobileDevice() && !isHovering) {
                    navigationSection.classList.add('hidden');
                    navigationSection.style.pointerEvents = 'none'; // Desabilita cliques e interações quando escondido
                }
            }

            // Função para lidar com o scroll - CORRIGIDA
            function handleScroll() {
                const currentScrollTop = window.scrollY || document.documentElement.scrollTop;

                if (isMobileDevice()) {
                    // MOBILE: O cabeçalho permanece sempre visível no mobile
                    if (navigationSection) {
                        navigationSection.classList.remove('hidden'); // Garante que esteja visível
                        navigationSection.style.pointerEvents = 'auto'; // Garante que esteja clicável
                    }
                    
                    // Fecha o menu se estiver aberto ao fazer scroll para baixo
                    if (isMenuOpen && currentScrollTop > lastScrollTop) {
                        closeMenu();
                    }
                    
                    // Botão back to top (visibilidade)
                    if (backToTopBtn) {
                        if (currentScrollTop === 0) {
                            backToTopBtn.classList.remove('visible');
                        } else {
                            backToTopBtn.classList.add('visible');
                        }
                    }
                } else {
                    // DESKTOP: Comportamento dinâmico
                    if (currentScrollTop === 0) { // No topo da página
                        showHeader();
                        if (backToTopBtn) backToTopBtn.classList.remove('visible');
                    } else { // Não está no topo
                        if (currentScrollTop > lastScrollTop) { // Rolando para baixo
                            if (!isHovering) { // Apenas esconde se não estiver com o mouse em cima
                                hideHeader();
                            }
                        } else { // Rolando para cima
                            showHeader();
                        }
                        if (backToTopBtn) backToTopBtn.classList.add('visible');
                    }
                }

                lastScrollTop = currentScrollTop;
                adjustBodyPadding(); // Mantém o padding do body ajustado dinamicamente
            }

            // Função para abrir o menu (MOBILE APENAS)
            function openMenu() {
                if (!isMobileDevice() || !navbarCollapse) return;
                
                navbarCollapse.classList.add('show');
                if (navbarToggler) navbarToggler.setAttribute('aria-expanded', 'true');
                isMenuOpen = true;
            }

            // Função para fechar o menu (MOBILE APENAS)
            function closeMenu() {
                if (!isMobileDevice() || !navbarCollapse) return;
                
                navbarCollapse.classList.remove('show');
                if (navbarToggler) navbarToggler.setAttribute('aria-expanded', 'false');
                isMenuOpen = false;
            }

            // Event listener para o botão hamburger (MOBILE APENAS)
            if (navbarToggler) {
                navbarToggler.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (!isMobileDevice()) return; // Ação apenas no mobile
                    
                    if (isMenuOpen) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                });
            }

            // Fecha o menu ao clicar fora dele (MOBILE APENAS)
            document.addEventListener('click', function(e) {
                if (!isMobileDevice() || !navigationSection) return;
                
                const clickedInsideNav = navigationSection.contains(e.target);
                
                if (!clickedInsideNav && isMenuOpen) {
                    closeMenu();
                }
            });

            // Fecha o menu ao clicar em um link do menu (MOBILE APENAS)
            const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (isMobileDevice() && isMenuOpen) {
                        setTimeout(() => {
                            closeMenu();
                        }, 100); // Pequeno atraso para garantir que o link seja clicado antes de fechar
                    }
                });
            });

            // Event Listeners para desktop - CORRIGIDOS (lógica de hover)
            if (navigationSection) {
                navigationSection.addEventListener('mouseenter', function() {
                    if (!isMobileDevice()) {
                        isHovering = true;
                        showHeader(); // Sempre mostra ao passar o mouse no desktop
                    }
                });

                navigationSection.addEventListener('mouseleave', function() {
                    if (!isMobileDevice()) {
                        isHovering = false;
                        // Só esconde se não estiver no topo da página
                        if (window.scrollY > 0) {
                            hideHeader();
                        }
                    }
                });
            }

            // Adiciona event listeners de scroll com throttling para performance
            let ticking = false;
            window.addEventListener('scroll', function() {
                if (!ticking) {
                    requestAnimationFrame(function() {
                        handleScroll();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            // Ajusta o comportamento ao redimensionar a janela
            window.addEventListener('resize', function() {
                if (navigationSection) {
                    headerHeight = navigationSection.offsetHeight; // Recalcula a altura do cabeçalho
                }
                adjustBodyPadding(); // Reajusta o padding do body
                
                // Se redimensionar para desktop e o menu mobile estiver aberto, fecha
                if (!isMobileDevice() && isMenuOpen) {
                    closeMenu();
                }
                
                handleScroll(); // Reavalia a visibilidade do cabeçalho
            });

            // Configuração inicial ao carregar a página
            window.addEventListener('load', function() {
                if (navigationSection) {
                    headerHeight = navigationSection.offsetHeight;
                }
                adjustBodyPadding();
                handleScroll(); // Define o estado inicial do cabeçalho
            });

            // Função global para voltar ao topo (chamada pelo botão)
            window.scrollToTop = function() {
                if (isMobileDevice() && isMenuOpen) {
                    closeMenu(); // Fecha o menu mobile ao voltar ao topo
                }
                
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            };

            // Executa uma vez para definir o estado inicial (caso a página recarregue já scrollada)
            handleScroll();
        });

        // CSS para corrigir as animações - INJETADO AUTOMATICAMENTE
        // Este bloco de CSS é importante para a funcionalidade do header
        const headerCSS = document.createElement('style');
        headerCSS.textContent = `
        /* Corrige o problema de piscar do header */
        #navigation {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            /* will-change: auto; é removido se não for estritamente necessário para otimização */
        }

        #navigation.hidden {
            transform: translateY(-100%); /* Move o cabeçalho para cima para escondê-lo */
            opacity: 0;
            pointer-events: none; /* Desabilita interações quando escondido */
        }

        /* Mobile específico: garante que o cabeçalho esteja sempre visível e com interações */
        @media (max-width: 991.98px) {
            #navigation {
                transform: translateY(0) !important; /* Sempre visível */
                opacity: 1 !important; /* Sempre opaco */
                pointer-events: auto !important; /* Sempre clicável */
                transition: none; /* Remove transições no mobile para evitar comportamentos inesperados */
            }
            
            /* Estilos para o menu colapsado no mobile (já presentes no seu código) */
            .navbar-collapse {
                background-color: #000000;
                border-top: 1px solid #1a1a1a;
                padding: 15px;
                border-radius: 0 0 10px 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }
            
            .navbar-nav .nav-link {
                padding: 12px 15px !important;
                margin: 5px 0;
                border-radius: 5px;
                transition: background-color 0.2s ease;
            }
            
            .navbar-nav .nav-link:hover {
                background-color: rgba(5, 252, 4, 0.1);
            }
            
            .navbar-toggler {
                border: 2px solid #05FC04;
                border-radius: 5px;
                padding: 8px;
                background-color: transparent;
                transition: all 0.3s ease;
            }
            
            .navbar-toggler:hover,
            .navbar-toggler:focus {
                background-color: rgba(5, 252, 4, 0.1);
                border-color: #04D803;
                box-shadow: 0 0 0 0.2rem rgba(5, 252, 4, 0.25);
                outline: none;
            }
        }

        /* Desktop específico: garante que o toggler esteja escondido e o menu visível */
        @media (min-width: 992px) {
            .navbar-toggler {
                display: none !important;
            }
            
            .navbar-collapse {
                display: flex !important; /* Garante que o menu esteja flexível no desktop */
            }
        }
        `;
        document.head.appendChild(headerCSS);
    </script>

</body>

</html>
