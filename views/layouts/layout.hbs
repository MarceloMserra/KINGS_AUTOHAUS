<!DOCTYPE html>
<html lang="en">

<head>
    <title>KINGS AUTOHAUS</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Stylesheet -->
    <link rel="icon" href="/images/auto_favi.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/css/style.css">
    <!-- Custom CSS file for premium theme - NOW CONTAINS HEADER STYLES -->
    <link rel="stylesheet" href="/css/premium-theme.css">
    <!-- Link to home.css - IMPORTANT: Ensure this file exists and contains home page specific styles -->
    <link rel="stylesheet" href="/css/home.css">
    <!-- NOVO: Link para financing.css - para a página de financiamento -->
    <link rel="stylesheet" href="/css/financing.css">
    <!-- NOVO: Link para login.css - para a página de login -->
    <link rel="stylesheet" href="/css/login.css">

    {{!-- Icons --}}
    <script src="https://kit.fontawesome.com/f7b393d83e.js" crossorigin="anonymous"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans+Caption&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        xintegrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <!-- CSS personalizado para o cabeçalho fixo e transições -->
    <style>
        /* Garante que a seção de navegação seja fixa no topo */
        #navigation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 1000; /* Garante que o cabeçalho fique acima de outros elementos */
            /* As transições para 'hidden' são definidas no CSS injetado no final do body */
        }

        /* Ajuste para o conteúdo da página não ficar por baixo do cabeçalho fixo */
        /* Este padding será ajustado dinamicamente pelo JavaScript, mas é um bom valor inicial */
        body {
            padding-top: 120px; /* Ajuste este valor de acordo com a altura total do seu cabeçalho */
        }
    </style>
</head>

<body>

    <!-- Top Bar - Geralmente permanece visível, mas pode ser ajustada se necessário -->
    <div class="top-bar bg-gray-900 text-white text-xs py-2 px-4 flex justify-between items-center z-50 relative">
        <div class="flex space-x-3">
            <a href="https://www.facebook.com/kingsautohaus" target="_blank" class="hover:text-green-500"><i class="fab fa-facebook-f"></i></a>
            <a href="https://www.google.com/maps/search/?api=1&query=1278%20Washington%20St,%20Holliston%20MA%2001746" target="_blank" class="hover:text-green-500"><i class="fab fa-google-plus-g"></i></a>
            <a href="https://www.instagram.com/kingsautous/" target="_blank" class="hover:text-green-500"><i class="fab fa-instagram"></i></a>
        </div>
        <div>
            <span class="mr-4"><i class="fas fa-map-marker-alt mr-1"></i>1278 Washington St, Holliston MA 01746</span>
            <span><i class="fas fa-phone mr-1"></i>+1 (774)523-7860</span>
        </div>
    </div>

    <!-- Main Navbar -->
    <section id="navigation">
        <div class="container-fluid" id="nav-container">
            <nav class="navbar navbar-expand-lg" id="main-navbar"> 
                <!-- Logo GRANDE à esquerda -->
                <a class="navbar-brand" href="/">
                    <img src="/images/kings_autohaus_logo.jpeg" alt="KINGS AUTOHAUS Logo">
                </a>
                
                <!-- Botão toggler -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
                    aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <!-- Menu e Informações de Contato/Redes Sociais -->
                <div class="collapse navbar-collapse" id="navbarNavDropdown">
                    <ul class="navbar-nav menu-horizontal">
                        <li class="nav-item">
                            <a class="nav-link" href="/gas">Inventory</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/financing">Financing</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/#about-us">About Us</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/#contact-info">Contact</a>
                        </li>
                        <li class="nav-item">
                            <!-- ATRIBUTO 'style' REMOVIDO PARA PERMITIR QUE O CSS EXTERNO CONTROLE O HOVER -->
                            <a class="nav-link btn btn-outline-light px-3 py-2" href="/login">
                                Login
                            </a>
                        </li>
                    </ul>
                    <!-- Informações de Contato e Redes Sociais - MOVIDAS AQUI -->
                    <div class="navbar-contact-info ml-auto d-flex align-items-center">
                        <span class="contact-info">
                            <i class="fas fa-map-marker-alt"></i> 1278 Washington St, Holliston MA 01746
                        </span>
                        <span class="contact-info mr-3">
                            <i class="fas fa-phone"></i> +1 (774)523-7860</span>
                        <div class="social-icons">
                            <a href="https://www.facebook.com/kingsautohaus" target="_blank" class="mr-2"><i class="fab fa-facebook-f"></i></a>
                            <a href="https://www.google.com/maps/search/?api=1&query=1278%20Washington%20St,%20Holliston%20MA%2001746" target="_blank" class="mr-2"><i class="fab fa-google-plus-g"></i></a>
                            <a href="https://www.instagram.com/kingsautous/" target="_blank" class="mr-2"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </section>

    {{{body}}}

    <!-- Botão de voltar ao topo - SEMPRE VISÍVEL -->
    <button id="backToTop" class="back-to-top-btn" onclick="scrollToTop()" aria-label="Back to Top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        xintegrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        xintegrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script src="/javascripts/ev_cars.js"></script>
    <script src="/javascripts/gas_cars.js"></script>

    <!-- ============================================ -->
    <!-- SCRIPT ÚNICO CORRIGIDO - HEADER E MOBILE MENU -->
    <!-- ============================================ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navigationSection = document.getElementById('navigation');
            const backToTopBtn = document.getElementById('backToTop');
            const body = document.body;
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('#navbarNavDropdown');
            
            let lastScrollTop = 0; // Variável para armazenar a última posição de scroll
            let isHovering = false; // Controla o estado de hover no desktop

            // Função para detectar se é dispositivo móvel (breakpoint do Bootstrap)
            function isMobileDevice() {
                return window.innerWidth <= 991.98;
            }

            // Função para ajustar o padding-top do body com base na altura do cabeçalho
            function adjustBodyPadding() {
                if (navigationSection) {
                    const currentHeaderHeight = navigationSection.offsetHeight;
                    body.style.paddingTop = `${currentHeaderHeight}px`;
                }
            }

            // Função para mostrar o cabeçalho (visível no desktop, ou sempre no mobile)
            function showHeader() {
                if (navigationSection) {
                    navigationSection.classList.remove('hidden');
                    navigationSection.style.pointerEvents = 'auto'; // Reabilita cliques e interações
                }
            }

            // Função para esconder o cabeçalho (apenas no desktop e quando não estiver com hover)
            function hideHeader() {
                if (navigationSection && !isMobileDevice() && !isHovering) {
                    // Esconde apenas se o menu mobile não estiver aberto
                    if (!navbarCollapse.classList.contains('show')) { 
                        navigationSection.classList.add('hidden');
                        navigationSection.style.pointerEvents = 'none'; // Desabilita interações
                    }
                }
            }

            // Função para lidar com o scroll
            function handleScroll() {
                const currentScrollTop = window.scrollY || document.documentElement.scrollTop;

                if (isMobileDevice()) {
                    // No mobile, o cabeçalho permanece sempre visível
                    if (navigationSection) {
                        navigationSection.classList.remove('hidden');
                        navigationSection.style.pointerEvents = 'auto';
                    }
                    
                    // Fecha o menu se estiver aberto e o usuário rolar para baixo
                    if (navbarCollapse.classList.contains('show') && currentScrollTop > lastScrollTop) {
                        $(navbarCollapse).collapse('hide'); // Usa o método collapse do Bootstrap
                    }
                    
                    // Lógica do botão "voltar ao topo" no mobile
                    if (backToTopBtn) {
                        if (currentScrollTop === 0) {
                            backToTopBtn.classList.remove('visible');
                        } else {
                            backToTopBtn.classList.add('visible');
                        }
                    }
                } else {
                    // No desktop, o cabeçalho se esconde/mostra
                    if (currentScrollTop === 0) { // No topo da página
                        showHeader();
                        if (backToTopBtn) backToTopBtn.classList.remove('visible');
                    } else { // Não está no topo
                        if (currentScrollTop > lastScrollTop) { // Rolando para baixo
                            if (!isHovering) { // Esconde apenas se não estiver com o mouse em cima
                                hideHeader();
                            }
                        } else { // Rolando para cima
                            showHeader();
                        }
                        if (backToTopBtn) backToTopBtn.classList.add('visible');
                    }
                }

                lastScrollTop = currentScrollTop;
                adjustBodyPadding(); // Mantém o padding do body ajustado dinamicamente
            }

            // Função para abrir o menu mobile
            function openMenu() {
                if (!isMobileDevice() || !navbarCollapse) return;
                
                navbarCollapse.classList.add('show');
                if (navbarToggler) navbarToggler.setAttribute('aria-expanded', 'true');
                isMenuOpen = true;
            }

            // Função para fechar o menu mobile
            function closeMenu() {
                if (!isMobileDevice() || !navbarCollapse) return;
                
                navbarCollapse.classList.remove('show');
                if (navbarToggler) navbarToggler.setAttribute('aria-expanded', 'false');
                isMenuOpen = false;
            }

            // Event listener para o botão hamburger
            if (navbarToggler) {
                navbarToggler.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation(); // Impede que o clique "suba" e feche o menu imediatamente
                    
                    if (isMobileDevice()) { // Só alterna o menu no mobile
                        $(navbarCollapse).collapse('toggle'); // Usa o método collapse do Bootstrap
                    }
                });
            }

            // Fecha o menu ao clicar fora dele (apenas no mobile)
            document.addEventListener('click', function(e) {
                if (!isMobileDevice() || !navigationSection) return;
                
                const clickedInsideNav = navigationSection.contains(e.target);
                
                if (!clickedInsideNav && $(navbarCollapse).hasClass('show')) {
                    $(navbarCollapse).collapse('hide');
                }
            });

            // Fecha o menu ao clicar em um link do menu (apenas no mobile)
            const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (isMobileDevice() && $(navbarCollapse).hasClass('show')) {
                        // Pequeno atraso para permitir que o navegador processe o clique no link
                        // antes de fechar o menu, especialmente para âncoras internas.
                        setTimeout(() => {
                            $(navbarCollapse).collapse('hide');
                        }, 100); 
                    }
                });
            });

            // Event Listeners para desktop (lógica de hover do cabeçalho)
            if (navigationSection) {
                navigationSection.addEventListener('mouseenter', function() {
                    if (!isMobileDevice()) {
                        isHovering = true;
                        showHeader(); // Sempre mostra ao passar o mouse no desktop
                    }
                });

                navigationSection.addEventListener('mouseleave', function() {
                    if (!isMobileDevice()) {
                        isHovering = false;
                        // Só esconde se não estiver no topo da página
                        if (window.scrollY > 0) {
                            hideHeader();
                        }
                    }
                });
            }

            // Adiciona event listeners de scroll com throttling para performance
            let ticking = false;
            window.addEventListener('scroll', function() {
                if (!ticking) {
                    requestAnimationFrame(function() {
                        handleScroll();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            // Ajusta o comportamento ao redimensionar a janela
            window.addEventListener('resize', function() {
                if (navigationSection) {
                    headerHeight = navigationSection.offsetHeight; // Recalcula a altura do cabeçalho
                }
                adjustBodyPadding(); // Reajusta o padding do body
                
                // Se redimensionar para desktop e o menu mobile estiver aberto, fecha
                if (!isMobileDevice() && $(navbarCollapse).hasClass('show')) {
                    $(navbarCollapse).collapse('hide');
                }
                
                handleScroll(); // Reavalia a visibilidade do cabeçalho
            });

            // Configuração inicial ao carregar a página
            window.addEventListener('load', function() {
                if (navigationSection) {
                    headerHeight = navigationSection.offsetHeight;
                }
                adjustBodyPadding();
                handleScroll(); // Define o estado inicial do cabeçalho
            });

            // Função global para voltar ao topo (chamada pelo botão)
            window.scrollToTop = function() {
                if (isMobileDevice() && $(navbarCollapse).hasClass('show')) {
                    $(navbarCollapse).collapse('hide'); // Fecha o menu mobile ao voltar ao topo
                }
                
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            };

            // Executa uma vez para definir o estado inicial (caso a página recarregue já scrollada)
            handleScroll();
        });
    </script>

</body>

</html>
